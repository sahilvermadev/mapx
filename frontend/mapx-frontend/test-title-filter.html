<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Title Filter Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .review-item {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .review-title {
            font-weight: bold;
            color: #333;
        }
        .review-notes {
            color: #666;
            margin-top: 5px;
        }
        .filtered {
            background: #fff3cd;
            border-color: #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Title Filter Test</h1>
        <p>This page tests the title filtering functionality to ensure auto-generated "Review of..." titles are properly filtered out.</p>
        
        <div>
            <button class="test-button" onclick="testTitleFilter()">Test Title Filtering</button>
            <button class="test-button" onclick="testRealReviews()">Test Real Reviews</button>
            <button class="test-button" onclick="clearResults()">Clear Results</button>
        </div>
        
        <div id="results" class="results" style="display: none;"></div>
    </div>

    <script type="module">
        // Title filtering function (same as in ContentCard)
        function getDisplayTitle(title, placeName) {
            if (!title) return undefined;
            const autoGeneratedPattern = new RegExp(`^Review of ${placeName}$`, 'i');
            return autoGeneratedPattern.test(title) ? undefined : title;
        }

        // Test the title filtering function
        window.testTitleFilter = () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results';
            resultsDiv.innerHTML = '<h3>Testing Title Filtering...</h3>';
            
            const placeName = 'Big Chill Cafe';
            const testCases = [
                { title: 'Review of Big Chill Cafe', expected: undefined, description: 'Auto-generated title' },
                { title: 'Review of BIG CHILL CAFE', expected: undefined, description: 'Auto-generated title (case insensitive)' },
                { title: 'Amazing Coffee Experience', expected: 'Amazing Coffee Experience', description: 'Meaningful title' },
                { title: 'Great food and atmosphere', expected: 'Great food and atmosphere', description: 'Custom title' },
                { title: 'Review of Big Chill Cafe - Amazing!', expected: 'Review of Big Chill Cafe - Amazing!', description: 'Modified auto-generated title' },
                { title: undefined, expected: undefined, description: 'No title' },
                { title: '', expected: undefined, description: 'Empty title' }
            ];

            let results = '<h3>‚úÖ Title Filtering Test Results</h3>';
            let allPassed = true;

            testCases.forEach((testCase, index) => {
                const result = getDisplayTitle(testCase.title, placeName);
                const passed = result === testCase.expected;
                allPassed = allPassed && passed;
                
                results += `
                    <div class="review-item ${passed ? '' : 'filtered'}">
                        <div><strong>Test ${index + 1}:</strong> ${testCase.description}</div>
                        <div><strong>Input:</strong> "${testCase.title || 'undefined'}"</div>
                        <div><strong>Expected:</strong> "${testCase.expected || 'undefined'}"</div>
                        <div><strong>Result:</strong> "${result || 'undefined'}"</div>
                        <div><strong>Status:</strong> ${passed ? '‚úÖ PASS' : '‚ùå FAIL'}</div>
                    </div>
                `;
            });

            resultsDiv.className = allPassed ? 'results success' : 'results error';
            resultsDiv.innerHTML = results;
        };

        // Test with real reviews from API
        window.testRealReviews = async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results';
            resultsDiv.innerHTML = '<h3>Testing Real Reviews...</h3>';
            
            try {
                const response = await fetch('http://localhost:5000/api/recommendations/place/3');
                const data = await response.json();
                
                if (response.ok && data.success) {
                    const placeName = 'Starbucks Reserve'; // Based on the API response
                    let results = '<h3>‚úÖ Real Reviews Test Results</h3>';
                    
                    data.data.forEach((review, index) => {
                        const originalTitle = review.title;
                        const filteredTitle = getDisplayTitle(review.title, placeName);
                        const wasFiltered = originalTitle && !filteredTitle;
                        
                        results += `
                            <div class="review-item ${wasFiltered ? 'filtered' : ''}">
                                <div><strong>Review ${index + 1}:</strong></div>
                                <div><strong>Original Title:</strong> "${originalTitle || 'undefined'}"</div>
                                <div><strong>Filtered Title:</strong> "${filteredTitle || 'undefined'}"</div>
                                <div><strong>Notes:</strong> "${review.notes || 'No notes'}"</div>
                                <div><strong>Status:</strong> ${wasFiltered ? 'üîç FILTERED' : '‚úÖ DISPLAYED'}</div>
                            </div>
                        `;
                    });
                    
                    resultsDiv.className = 'results success';
                    resultsDiv.innerHTML = results;
                } else {
                    throw new Error(`API Error: ${response.status}`);
                }
            } catch (error) {
                resultsDiv.className = 'results error';
                resultsDiv.innerHTML = `
                    <h3>‚ùå Real Reviews Test Failed</h3>
                    <p>Error: ${error.message}</p>
                `;
            }
        };

        window.clearResults = () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'none';
        };

        // Auto-run basic test on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                testTitleFilter();
            }, 1000);
        });
    </script>
</body>
</html> 